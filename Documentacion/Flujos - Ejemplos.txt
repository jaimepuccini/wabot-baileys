// Flujos primarios

const flowGracias = addKeyword (['gracias', 'agradecido', 'agradecida', 'te agradezco'])
    .addAnswer('Es un gran placer poder servirte, estamos a tu orden.')

const flowUbicacion = addKeyword (['ubicacion', 'ubicaci√≥n', 'ubicado','donde estan ubicados', 'd√≥nde est√°n ubicados', 'donde te ubicas', 'd√≥nde te ubicas', 'd√≥nde se ubican', 'donde se ubican'])
    .addAnswer('Trabajamos desde La Victoria-Aragua, pero atendemos a particulares y empresas entre Las Tejer√≠as y Maracay, en esta zona tenemos delivery gratis, fuera de ella, enviamos por Domesa, MRW, o Tealca')

const flowTienda = addKeyword ('Escribo desde la tienda virtual de ITSCA, estoy interesado en')
    .addAnswer('*Gracias por visitar nuestra tienda en l√≠nea*!\n\nNormalmente toda la informaci√≥n est√° justo en la p√°gina que te trajo a este chat, de no ser el caso por favor dejanos s√°ber cu√°l es tu inquietud o requerimiento.')

const flowBeam = addKeyword (['beam',  'video bin', 'bean', 'video bean', 'video beam', '7'])
    .addAnswer('Tenemos el servicio de Alquiler de Video Beam por hora, √∫nicamente para El Consejo, La Victoria, Cagua, Turmero y Maracay, por el precio base de 5$ la hora.\n\nToda la informaci√≥n que requieres est√° disponible en el siguiente link a nuestra p√°gina. Por favor, aseg√∫rate de haber le√≠do las *CONDICIONES DEL SERVICIO*: https://itsca.net/producto/servicio-de-alquiler-de-video-beam/?ref=bot\n\nPregunta lo que necesites si a√∫n te queda alguna inquietud. Si deseas contratar el servicio, requerimos que nos env√≠es:\n- La fecha, hora y direcci√≥n precisa del evento para darte confirmaci√≥n de que tenemos disponible en agenda el tiempo que se requiere para servirles debidamente.\n- Nombre y n√∫mero de tel√©fono de quien nos recibe.\n\nNos dar√° mucho gusto apoyarte en el evento.', {media:'https://www.itsca.net/wp-content/uploads/Video-Beam-2.jpg'})
    .addAnswer('Hay algo m√°s en lo que te pueda ayudar?\n\n[0] Regresar', {delay: 500,})

const flowPagos = addKeyword (['pago', 'medios de pago', 'te puedo pagar', 'zelle', 'usdt', 'binance', 'airtm','divisas'])
    .addAnswer('üí∞üí∞üí∞üí∞üí∞üí∞üí∞\n\nPuedes pagar con:\n‚úÖ Divisas\n‚úÖ Pago m√≥vil\n‚úÖ USDT\n‚úÖ Zinli, o\n‚úÖ AirTm.')

const flowPagomovil = addKeyword (['pagomovil', 'pago movil', 'pago m√≥vil'])
    .addAnswer('üí∞üí∞üí∞üí∞üí∞üí∞üí∞\n\nCedula: 11183350\nMovil: 0412-8471525\nBancos: Mercantil o Exterior\n\nRecuerda pasarme el capture del pago. Gracias')

// flujos dependientes del principal

const endesarrolloFlow = addKeyword(['1', '2', '3', '4', '5', '6'])
.addAnswer(
[
    'Esta respuesta aun esta en desarrollo, te pedimos disculpas\n',
    '0Ô∏è‚É£ Regresar'
],null
);


const productosFlow = addKeyword('1')
.addAnswer('¬°Claro! Te invitamos a visitar nuestra tienda en l√≠nea donde encontrar√°s una amplia variedad de productos. \n\nüõí Puedes consultar nuestro cat√°logo completo en este enlace:\nhttps://itsca.net/tienda?ref=bot\n\nPero cu√©ntame, ¬øqu√© dispositivo est√°s buscando?, si no lo tenemos igual podemos buscarlo para ti. Y recuerda que tenemos delivery gratis en El Consejo, La Victoria, Cagua, Turmero y Maracay.')
.addAnswer(
[
  '\n¬øEn qu√© tipo producto est√°s interesado?\n',
  '1Ô∏è‚É£ Cables y adaptadores',
  '2Ô∏è‚É£ Internet, Redes y Wifi',
  '3Ô∏è‚É£ Accesorios',
  '4Ô∏è‚É£ Almacenamiento',
  '5Ô∏è‚É£ Dom√≥tica',
  '0Ô∏è‚É£ Regresar'
],null, null, endesarrolloFlow
);

const serviciosFlow = addKeyword('2')
.addAnswer('ITS, C.A o ITSCA es una empresa de servicios de tecnolog√≠a para usuarios dom√©sticos, comerciales e industriales.\n\nNuestros servicios comprenden varios aspectos, desde la venta de todo tipo de dispositivos de computaci√≥n y sus accesorios, sistemas y c√°maras de seguridad, hasta su implementaci√≥n, soporte y mantenimiento.\nAdministramos redes y servidores, y tambi√©n alquilamos *video beam* por horas.\n\nAtendemos clientes en Las Tejer√≠as, La Victoria, Cagua, Turmero y Maracay, pero ya que virtualmente no hay l√≠mites, incluso de forma remota hemos podido apoyar a personas y empresas en otros paises.\n\nSi quieres saber m√°s de nosotros, visita: http://itsca.net/servicios/?ref=bot')
.addAnswer('Trabajamos desde La Victoria-Aragua, en la zona de atenci√≥n y servicios tenemos delivery gratis, fuera de ella, enviamos por Domesa, MRW, o Tealca', {delay: 500,})
.addAnswer('Si lo deseas, puedes dejarnos tu inquietud y con gusto te lo aclaramos, o mejor, podemos concertar una visita y as√≠ vemos la mejor forma de apoyarte.', {delay: 500,})
.addAnswer(
[
  '\n¬øEn qu√© tipo servicio est√°s interesado?\n',
  '1Ô∏è‚É£ C√°maras de seguridad',
  '2Ô∏è‚É£ Administraci√≥n de redes y Wifi',
  '3Ô∏è‚É£ Dise√±o Web',
  '4Ô∏è‚É£ Configuraci√≥n de dispositivos',
  '5Ô∏è‚É£ Servicio t√©cnico y soporte a usuario',
  '6Ô∏è‚É£ Visita de diagn√≥stico',
  '7Ô∏è‚É£ Alquiler de Video Beam',
  '0Ô∏è‚É£ Regresar'
],null, null, [flowBeam, endesarrolloFlow]
);

const faqFlow = addKeyword('3')
.addAnswer('Hemos preparado el siguiente link, donde puedes consultar una lista organizada de lo que a la mayor√≠a de las personas les causa inter√©s, curiosidad o inquietud.\n\nFAQ: üëâ https://itsca.net/faq/?ref=bot\n\nApreciar√≠amos que visites en link, ya que lo mas probable, es que ah√≠ est√© la respuesta que buscas.')

const salirFlow = addKeyword('4')
.addAnswer('A la brevedad posible, alguien seguir√° con este chat para darte mejor apoyo y respuestas. Si es la primera vez que nos escribes, nos ayudar√° mucho saber tu nombre, desde d√≥nde escribes y una breve descripcion de lo que requieres.\n\n*Gracias por escribirnos*')

const welcomeFlow = addKeyword ('Hola')
    .addAnswer('Bienvenido al ChatBot de ITSCA.NET\n\n- Est√°s buscando alg√∫n producto de tecnolog√≠a?, Mira todo nuestro cat√°logo en: https://www.itsca.net/categoria-producto/todos/?ref=wabot\n- Si quieres conocer de nuestros servicios, entra en: https://www.itsca.net/servicios?ref=wabot\n\nA ver... ¬øCu√©ntame c√≥mo podemos apoyarte?', {media:'https://www.itsca.net/wp-content/uploads/Carrito_Itsca.png'})
    .addAnswer('Esribe "*BOT*" para guiarte con un men√∫ de atenci√≥n inmediata.')

const flowBienvenida = addKeyword(['bot', 'hi', '0'])
    .addAnswer(`üôå Bienvenido al *Chatbot* de ITSCA.NET\n\nPara atenderte m√°s r√°pido, quisiera ofrecerte las siguientes opciones de informaci√≥n.`)
    .addAnswer(
        [
            'Escribe el *N√öMERO* de la opci√≥n que quieres:\n',
            '1Ô∏è‚É£ *Productos* que vendemos üõí',
            '2Ô∏è‚É£ *Servicios* que prestamos ‚öôÔ∏è',
            '3Ô∏è‚É£ *FAQ* o preguntas frecuentes ‚ùì',
            '4Ô∏è‚É£ *Salir* del bot üí™'
        ].join('\n'),
        { delay: 800, capture: true },
        async (ctx, { fallBack }) => {
            console.log('ctx.body:', ctx.body); // Verifica lo que hay en ctx.body
            
            const input = ctx.body ? ctx.body.trim() : ''; // Captura y limpia la entrada
            
            if (!input) {
                return fallBack('No has ingresado ninguna opci√≥n. Por favor, escribe el n√∫mero de la opci√≥n que deseas:\n1. Productos\n2. Servicios\n3. FAQ\n4. Salir');
            }

            console.log('Input recibido:', input); // Depuraci√≥n

            // Verifica si el input es uno de los valores v√°lidos
            if (!['1', '2', '3', '4'].includes(input)) {
                console.log('Opci√≥n no v√°lida:', input);
                return fallBack('Opci√≥n no v√°lida. Por favor, escribe el n√∫mero de la opci√≥n que deseas:\n1. Productos\n2. Servicios\n3. FAQ\n4. Salir');
            }

            console.log('Input v√°lido:', input); // Depuraci√≥n
        },[productosFlow, serviciosFlow, faqFlow, salirFlow]
    );





************************************************************
Flujos valido cuando se ha cambiado el Payload en el
index.cjs para escuchar los mensajes de los grupos tambi√©n
***********************************************************

const flowGroup = addKeyword<Provider, Database>(EVENTS.WELCOME)
    .addAction(async (ctx, ctxFn) => {
        const isMessageFromGroup = !!ctx.message.extendedTextMessage
        console.log(ctx)
        if (isMessageFromGroup) {
            //const groupJid = ctx.from.split('@')[0]
            console.log('Nombre de usuario:', ctx.name)
            console.log('Mensaje del grupo:', ctx.body)
            //console.log('JID del grupo:', ctx.message.extendedTextMessage.contextInfo)
            //await ctxFn.provider.sendText('120363352541309767@g.us', 'Hola _*' + (ctx.name) + '*_, bienvenido a nuestro chatbot de ITSCA.NET. ¬øEn qu√© podemos ayudarte hoy?')
        } else {
            console.log(ctx.name)
            //await ctxFn.flowDynamic ('Hola _*' + (ctx.name) + '*_, bienvenido a nuestro chatbot de ITSCA.NET. ¬øEn qu√© podemos ayudarte hoy?')
        }})



************************************************************
Flujos con botones
Solo funciona cuando el provider es META.
Requiere de una api key y otras cosas.
************************************************************

const Productos = addKeyword ('Productos que vendemos')
    .addAnswer('Tenemos una amplia gama de productos de tecnolog√≠a, puedes verlos en nuestra tienda virtual',
    {
        buttons: [
            { body: 'Ver productos', label: 'Ver productos'}
        ]
    })

const flowMenu = addKeyword ('bot')
    .addAnswer('Bienvenido, por favor selecciona una opci√≥n',
    {
        capture: true,
        buttons: [
            { body: 'Productos que vendemos', label: 'Productos que vendemos'}
            { body: 'Qu√© servicios prestamos', label: 'Qu√© servicios prestamos'}
            { body: 'Preguntas frecuentes', label: 'Preguntas frecuentes'}
            { body: 'Salir del bot'}
        ]
    }, null,
    [Productos, Servicios, Preguntas, Salir])




************************************************************
Flujos con addAction
************************************************************

// Flow para el saludo de bienvenida
const flowSaludo = addKeyword(['hi'])
.addAction(async (ctx, ctxFn) => {
        console.log(ctx)
        const ahora = Date.now();
        await ctxFn.flowDynamic ('Hola _*' + (ctx.name) + '*_, '+ obtenerSaludo(ahora) +' gracias por esribir a ITSCA.NET. ¬øEn qu√© podemos ayudarte hoy?')
    })



************************************************************
Flujos que te permite mostrar el preview de un link
To see link preview, link preview js must be installed:\n`pnpm i link-preview-js`
************************************************************
const pruebaFlow = addKeyword('pr')
    .addAnswer(`üôå Example linkPreview`)
    .addAction(
        async (_, { flowDynamic }) => {
            await flowDynamic('To see link preview, link preview js must be installed:\n`pnpm i link-preview-js`')
            await flowDynamic('*Producto:*\nhttps://itsca.net/producto/ssd-m-2-pcie-gen3x4-addlink/?ref=2')
        }
    ) 